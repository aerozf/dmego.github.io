{"title":"Mybatis 逆向工程中使用 Mysql 8.0 版本驱动遇到的问题","date":"2018-10-10T06:49:00.000Z","author":"Dmego","link":"2018/10/10/mysql8-mybatis-geneator","comments":true,"tags":["Mybatis"],"categories":["技术"],"updated":"2019-12-22T18:21:32.541Z","content":"<a id=\"more\"></a>\n <center>\n<img src=\"/2018/10/10/mysql8-mybatis-geneator/mybatis-logo.png\" width=\"250px\">\n</center>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"2018/10/10/mysql8-mybatis-geneator#前言\"></a> 前言<a href=\"2018/10/10/mysql8-mybatis-geneator#前言\"></a></h2>\n<p>今天在使用<code>8.0.12</code>版的 mysql 驱动时遇到了各种各样的坑，在使用 JDBC 连接上遇到的问题可以参考我的上一篇<a href=\"https://dmego.me/2018/10/10/java-connect-mysql-error.html\">博客</a>。我在使用 mybatis 逆向工程生成各种 <code>mapper</code>，<code>pojo</code>，<code>dao</code>时，遇到了一个困惑我好几个小时的错误，这个错误是</p>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Result Maps collection already contains value for BaseResultMap</span><br></pre></td></tr></table></div></figure>\n<p>产生这个错误可能有各种原因。但是这里我只说我的原因及解决过程。</p>\n<h2 id=\"初步探索\"><a class=\"markdownIt-Anchor\" href=\"2018/10/10/mysql8-mybatis-geneator#初步探索\"></a> 初步探索<a href=\"2018/10/10/mysql8-mybatis-geneator#初步探索\"></a></h2>\n<p>我在网上查阅了大量的博客文章，对于产生这类错误的原因最多的是：生成了多次 <code>mapper</code>，<code>dao</code>以及<code>pojo</code> 文件。也就是多次运行了生成这些文件的方法。造成<code>XXXmapper.xml</code>中出现了重复的<code>resultmap</code>。但是我这里把这些文件删除后，再重新生成还是会报这个错。所以肯定不是多次生成的问题。</p>\n<p>于是我打开了出现问题的那个<code>Mapper.xml</code>文件，搜索<code>BaseResultMap</code>发现其作为<code>resultMap</code>的<code>id</code>居然出现了三次，还有很多其他的<code>sql</code>标签的<code>id</code>也有很多重复的。我将这些重复的都删除，再次运行，成功了，没有出现错误。而且利用这些生成的 <code>mapper</code>做后面的功能也没有任何问题。这就非常奇怪，为什么会多生成这些代码呢，我继续在网上找相关的文章。</p>\n<h2 id=\"深入探索\"><a class=\"markdownIt-Anchor\" href=\"2018/10/10/mysql8-mybatis-geneator#深入探索\"></a> 深入探索<a href=\"2018/10/10/mysql8-mybatis-geneator#深入探索\"></a></h2>\n<p>好不容易找到一篇博客中提到 ：升级到 mysql 8.0 驱动后的使用 mybatis 逆向工程生成的文件或不一样，具体的怎么不一样也没有说。看到这里，我猜会不会是驱动版本造成的，于是我将 <code>pom.xml</code>里的 mysql 驱动版本调整到了 5.1.10。删干净文件，再次生成后，发现之前出错的那个 <code>mapper.xml</code>里的 以 <code>BaseResultMap</code>作为 <code>id</code> 的 <code>resultMap</code> 只有一个了，其他的<code>resultMap</code>中<code>id</code> 也是唯一的。为了检验这次生成的到底有没有用。我启动 <code>Tomact</code>运行程序。发现正常启动，后续的功能也没有问题。</p>\n<h2 id=\"最终解决\"><a class=\"markdownIt-Anchor\" href=\"2018/10/10/mysql8-mybatis-geneator#最终解决\"></a> 最终解决<a href=\"2018/10/10/mysql8-mybatis-geneator#最终解决\"></a></h2>\n<p>但是如果使用 5.0 版本的驱动连接 mysql 8.0 在项目中可能会遇到难以预料的问题，所以我并没有就此将驱动版本改变。我继续在网上通过换各种关键词来搜寻解决方案。几个小时过去了，还是没有任何结果。最后被迫去看了 <code>[MyBatis Generator]</code>的官方英文文档。中文文档已经看过了，没有找到相关的内容。在阅读英文文档中，我在<a href=\"http://www.mybatis.org/generator/usage/intro.html\" target=\"_blank\" rel=\"noopener\">Database Specific Information</a>(使用注意事项)下面的<a href=\"http://www.mybatis.org/generator/usage/mysql.html#\" target=\"_blank\" rel=\"noopener\">mysql使用注意事项</a>中似乎找到了相关的内容。其原内容如下：</p>\n<blockquote>\n<p>If you are using version 8.x of Connector/J you may notice that the generator attempts to generate code for tables in the MySql information schemas (sys, information_schema, performance_schema, etc.) This is probably not what you want! To disable this behavior, add the property “nullCatalogMeansCurrent=true” to your JDBC URL.</p>\n</blockquote>\n<blockquote>\n<p>For example:</p>\n</blockquote>\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://localhost/my_schema&quot;</span><br><span class=\"line\">         userId=&quot;my_user&quot; password=&quot;my_password&quot;&gt;</span><br><span class=\"line\">     &lt;property name=&quot;nullCatalogMeansCurrent&quot; value=true&quot; /&gt;</span><br><span class=\"line\"> &lt;/jdbcConnection&gt;</span><br></pre></td></tr></table></div></figure>\n<p>上面的英文文档翻译过来就是:</p>\n<blockquote>\n<p>如果您使用的是Connector / J的8.x版，您可能会注意到生成器尝试为MySql信息模式（sys，information_schema，performance_schema等）中的表生成代码。这可能不是您想要的！ 要禁用此行为，请将属性“nullCatalogMeansCurrent = true”添加到JDBC</p>\n</blockquote>\n<p>的确，我发现使用 8.0 版的驱动比使用 5.0 版时不仅<code>mapper.xml</code>文件中多生成了好多代码，而且还多生成了一个<code>xxxWithBLOBs</code>的<code>pojo</code>文件。虽然还是不太理解上面说的问题，但是我还是添加 nullCatalogMeansCurrent 属性。然后重新生成了相关的<code>mapper</code>，<code>pojo</code>，<code>dao</code>。打开之前出现问题的<code>mapper.xml</code>文件，和使用 5.0 版的驱动生成的代码一样，以 <code>BaseResultMap</code>作为 id 的 resultMap 只有一个了。再次启动 Tomact，成功启动，没有任何问题，测试其他业务功能，也没有任何问题。</p>\n<h2 id=\"后记\"><a class=\"markdownIt-Anchor\" href=\"2018/10/10/mysql8-mybatis-geneator#后记\"></a> 后记<a href=\"2018/10/10/mysql8-mybatis-geneator#后记\"></a></h2>\n<p>下面是我找到的相关问题的帖子或博客，虽然没有解决我问题，但是也可能会遇到，这里记录一下</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_37718636/article/details/81413800\" target=\"_blank\" rel=\"noopener\">mysql8.0逆向工程遇到的坑</a></li>\n<li><a href=\"https://blog.csdn.net/weixin_38107930/article/details/82556164\" target=\"_blank\" rel=\"noopener\">MyBatis Generator mysql8.0版本的连接的注意点</a></li>\n<li><a href=\"https://blog.csdn.net/zengdeqing2012/article/details/46340357\" target=\"_blank\" rel=\"noopener\">mybatis(错误一) 项目启动时报“Result Maps collection already contains value forxxx”的解决方案</a></li>\n<li><a href=\"https://blog.csdn.net/qq_37350706/article/details/81429154\" target=\"_blank\" rel=\"noopener\">mybatis.generator配上最新的mysql 8.0.11的一些坑</a></li>\n<li><a href=\"https://blog.csdn.net/Mint6/article/details/81869777\" target=\"_blank\" rel=\"noopener\">mysql8.0 mybatis逆向工程 mybatis-generator</a></li>\n</ul>\n","prev":{"title":"决策模型(一)：不确定型决策法","link":"2018/11/04/decision-making-under-uncertainty"},"next":{"title":"JDBC连接Mysql数据库出现的问题汇总","link":"2018/10/10/java-connect-mysql-error"},"plink":"https://dmego.me/2018/10/10/mysql8-mybatis-geneator/","toc":[{"title":"<a class=\"markdownIt-Anchor\"></a> 前言","id":"前言","index":"1"},{"title":"<a class=\"markdownIt-Anchor\"></a> 初步探索","id":"初步探索","index":"2"},{"title":"<a class=\"markdownIt-Anchor\"></a> 深入探索","id":"深入探索","index":"3"},{"title":"<a class=\"markdownIt-Anchor\"></a> 最终解决","id":"最终解决","index":"4"},{"title":"<a class=\"markdownIt-Anchor\"></a> 后记","id":"后记","index":"5"}],"copyright":{"link":"<a href=\"https://dmego.me/2018/10/10/mysql8-mybatis-geneator/\" title=\"Mybatis 逆向工程中使用 Mysql 8.0 版本驱动遇到的问题\">https://dmego.me/2018/10/10/mysql8-mybatis-geneator/</a>","license":"自由转载-非商用-禁止演绎-保持署名(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}