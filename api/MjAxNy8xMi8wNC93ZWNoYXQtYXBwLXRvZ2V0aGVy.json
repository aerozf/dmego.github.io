{"title":"微信小程序：出发吧一起","date":"2017-12-04T13:45:00.000Z","author":"Dmego","link":"2017/12/04/wechat-app-together","comments":true,"tags":["微信小程序"],"categories":["技术"],"updated":"2019-12-22T18:21:32.545Z","content":"<a id=\"more\"></a>\n<center>\n<img src=\"/2017/12/04/wechat-app-together/mjIhk6LFBE.png\" width=\"250px\">\n</center>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#前言\"></a> 前言<a href=\"2017/12/04/wechat-app-together#前言\"></a></h2>\n<p>经过将近一个多月的开发,我们团队开发的微信小程序 “出发吧一起” 终于开发完成,现在的线上版本为 2.2.4-beta 版</p>\n<p>本文档主要介绍该小程序在开发中所用到的技术,已经在开发中遇到问题的采取的解决方法</p>\n<ul>\n<li>\n<p>原文链接（转载请注明出处）：<a href=\"http://dmego.me/2017/12/04/wechat-app-together.html\">微信小程序：出发吧一起</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/dmego/together\" target=\"_blank\" rel=\"noopener\">开源地址</a></p>\n</li>\n</ul>\n<h2 id=\"小程序简介\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#小程序简介\"></a> 小程序简介<a href=\"2017/12/04/wechat-app-together#小程序简介\"></a></h2>\n<p>“让兴趣不再孤单，让爱好不再流浪” 是微信小程序《出发吧一起》的主题，这款小程序旨在解决当代大学生在校园生活中的孤独感，让大家找到志同道合的朋友，在跑步、健身、竞赛等活动中找到伙伴。利用小程序即开即用，用完就走的特点与交友相结合，它将会是一款高效快捷、无负担的线下交友利器</p>\n<p>本小程序由 <a href=\"https://www.bmob.cn/\" target=\"_blank\" rel=\"noopener\">bmob</a> 后端云提供数据处理与存储支持</p>\n<h2 id=\"小程序码\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#小程序码\"></a> 小程序码<a href=\"2017/12/04/wechat-app-together#小程序码\"></a></h2>\n<center>\n欢迎扫描体验\n<center>\n</center>\n<img src=\"/2017/12/04/wechat-app-together/1fIA6jdFla.jpg\" width=\"250px\">\n</center>\n<h2 id=\"开发中技术问题汇总\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#开发中技术问题汇总\"></a> 开发中技术问题汇总<a href=\"2017/12/04/wechat-app-together#开发中技术问题汇总\"></a></h2>\n<h3 id=\"1使用etargetdataset的出现问题\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#1使用etargetdataset的出现问题\"></a> 1.使用e.target.dataset的出现问题<a href=\"2017/12/04/wechat-app-together#1使用etargetdataset的出现问题\"></a></h3>\n<p>在小程序开发过程中,我们经常会用到标签中属性的属性值,我们通常会在 <code>&lt;view&gt;</code> 中 设置 <code>data-*=&quot;&quot;</code> 然后在 <code>JS</code> 里通过 <code>e.target.dateset.*</code> 来获取<code>XXX</code>值,但是我经常遇到获取的是<code>undefined</code>,使用 <code>console.log(e)</code> 查看输出信息会发现,在 <code>e</code>对象中包含两个对象分别是<code>currentTarget</code>和<code>target</code>,而往往有些时候数据在<code>currentTarget</code>中,</p>\n<p>此时可以将代码替换成这样来获取值</p>\n<ul>\n<li>WXML</li>\n</ul>\n<figure class=\"highlight html\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">\"bintap\"</span> <span class=\"attr\">data-id</span>=<span class=\"string\">\"1\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bintap:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> id = e.currentTarget.dataset.id;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>网上还有一直说法是 <code>data-*</code> 里 <code>*</code> 命名的问题,去掉驼峰式命名,纯小写也能解决</p>\n<h3 id=\"2小程序-textarea-文本框如何显示实时字数\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#2小程序-textarea-文本框如何显示实时字数\"></a> 2.小程序 textarea 文本框如何显示实时字数<a href=\"2017/12/04/wechat-app-together#2小程序-textarea-文本框如何显示实时字数\"></a></h3>\n<ul>\n<li>WXML</li>\n</ul>\n<figure class=\"highlight html\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">name</span>=<span class=\"string\">\"content\"</span> <span class=\"attr\">bindinput</span>=<span class=\"string\">\"bindTextAreaChange\"</span> <span class=\"attr\">maxlength</span>=<span class=\"string\">\"&#123;&#123;noteMaxLen&#125;&#125;\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">\"chnumber\"</span>&gt;</span>&#123;&#123;noteNowLen&#125;&#125;/&#123;&#123;noteMaxLen&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data:&#123;</span><br><span class=\"line\">    noteMaxLen: <span class=\"number\">200</span>,<span class=\"comment\">//备注最多字数</span></span><br><span class=\"line\">    noteNowLen: <span class=\"number\">0</span>,<span class=\"comment\">//备注当前字数</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//字数改变触发事件</span></span><br><span class=\"line\">  bindTextAreaChange: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = e.detail.value,</span><br><span class=\"line\">      len = <span class=\"built_in\">parseInt</span>(value.length);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (len &gt; that.data.noteMaxLen)</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    that.setData(&#123;</span><br><span class=\"line\">      content: value, <span class=\"attr\">noteNowLen</span>: len</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"3利用-js-实现模糊查询\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#3利用-js-实现模糊查询\"></a> 3.利用 JS 实现模糊查询<a href=\"2017/12/04/wechat-app-together#3利用-js-实现模糊查询\"></a></h3>\n<p>由于我们使用的是 <a href=\"https://www.bmob.cn/\" target=\"_blank\" rel=\"noopener\">Bmob</a> 后端云提供的数据处理与存储支持，根据 Bmob 提供的开发文档，免费版的应用无法进行模糊查询，看到这里，再看看已经快完工的活动检索界面，感受无法言说。正当准备放弃的时候，突然想到一个方法，那就是先把所有的后台所有数据都存到集合里，然后根据输入的检索值一个个匹配，想到之后马上就开始着手干了，先查了一下<code>javaScript</code> 文档,<code>String</code> 对象有一个方法是 <code>indexOf()</code> ,可返回某个指定的字符串值在字符串中首次出现的位置,这样就成了,遍历 所以数据,检索每一条数据的每个字符,如果出现了则将它加入到检索结果的集合中.</p>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//js 实现模糊匹配查询</span></span><br><span class=\"line\">  findEach: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> strFind = that.data.wxSearchData.value; <span class=\"comment\">//这里使用的 wxSearch 搜索UI插件,</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strFind == <span class=\"literal\">null</span> || strFind == <span class=\"string\">\"\"</span>) &#123;</span><br><span class=\"line\">      wx.showToast(&#123;</span><br><span class=\"line\">        title: <span class=\"string\">'输入为空'</span>,</span><br><span class=\"line\">        icon: <span class=\"string\">'loading'</span>,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strFind != <span class=\"string\">\"\"</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> nPos;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> resultPost = [];</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> smoodList) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> sTxt = smoodList[i].title || <span class=\"string\">''</span>; <span class=\"comment\">//活动的标题</span></span><br><span class=\"line\">        nPos = sTxt.indexOf(strFind); </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nPos &gt;= <span class=\"number\">0</span>) &#123;<span class=\"comment\">//如果输入的关键字在该活动标题中出现过,则匹配该活动</span></span><br><span class=\"line\">          resultPost.push(smoodList[i]); <span class=\"comment\">//将该活动加入到搜索到的活动列表中</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      that.setData(&#123;</span><br><span class=\"line\">        moodList: resultPost</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></div></figure>\n<p>更加详细的代码请前往<a href=\"https://github.com/dmego/together\" target=\"_blank\" rel=\"noopener\">Github</a>查看</p>\n<h3 id=\"4使用-js-将字符串格式的时间转换成几秒前几分钟前\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#4使用-js-将字符串格式的时间转换成几秒前几分钟前\"></a> 4.使用 JS 将字符串格式的时间转换成几秒前,几分钟前…<a href=\"2017/12/04/wechat-app-together#4使用-js-将字符串格式的时间转换成几秒前几分钟前\"></a></h3>\n<p>由于小程序中涉及评论,加入活动,收藏等一系列包括事件时间的功能,而数据库中存的时间格式为 <code>2017-11-30 23:36:10</code> 现在想要在界面上不显示具体时间,而是显示与当前时间的差,即几秒前,几分钟前等等</p>\n<p>实现起来并不复杂,主要思路是先把字符串的时间转换成时间戳,然后与当前的时间戳进行比较,这样就能转换成几秒前、几分钟前、几小时前、几天前等形式了</p>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//字符串转换为时间戳</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDateTimeStamp</span>(<span class=\"params\">dateStr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Date</span>.parse(dateStr.replace(<span class=\"regexp\">/-/gi</span>, <span class=\"string\">\"/\"</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//格式化时间</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDateDiff</span>(<span class=\"params\">dateStr</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> publishTime = getDateTimeStamp(dateStr) / <span class=\"number\">1000</span>,</span><br><span class=\"line\">    d_seconds,</span><br><span class=\"line\">    d_minutes,</span><br><span class=\"line\">    d_hours,</span><br><span class=\"line\">    d_days,</span><br><span class=\"line\">    timeNow = <span class=\"built_in\">parseInt</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() / <span class=\"number\">1000</span>),</span><br><span class=\"line\">    d,</span><br><span class=\"line\"></span><br><span class=\"line\">    date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(publishTime * <span class=\"number\">1000</span>),</span><br><span class=\"line\">    Y = date.getFullYear(),</span><br><span class=\"line\">    M = date.getMonth() + <span class=\"number\">1</span>,</span><br><span class=\"line\">    D = date.getDate(),</span><br><span class=\"line\">    H = date.getHours(),</span><br><span class=\"line\">    m = date.getMinutes(),</span><br><span class=\"line\">    s = date.getSeconds();</span><br><span class=\"line\">  <span class=\"comment\">//小于10的在前面补0</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (M &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    M = <span class=\"string\">'0'</span> + M;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (D &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    D = <span class=\"string\">'0'</span> + D;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (H &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    H = <span class=\"string\">'0'</span> + H;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (m &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    m = <span class=\"string\">'0'</span> + m;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (s &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    s = <span class=\"string\">'0'</span> + s;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  d = timeNow - publishTime;</span><br><span class=\"line\">  d_days = <span class=\"built_in\">parseInt</span>(d / <span class=\"number\">86400</span>);</span><br><span class=\"line\">  d_hours = <span class=\"built_in\">parseInt</span>(d / <span class=\"number\">3600</span>);</span><br><span class=\"line\">  d_minutes = <span class=\"built_in\">parseInt</span>(d / <span class=\"number\">60</span>);</span><br><span class=\"line\">  d_seconds = <span class=\"built_in\">parseInt</span>(d);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (d_days &gt; <span class=\"number\">0</span> &amp;&amp; d_days &lt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> d_days + <span class=\"string\">'天前'</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d_days &lt;= <span class=\"number\">0</span> &amp;&amp; d_hours &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> d_hours + <span class=\"string\">'小时前'</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d_hours &lt;= <span class=\"number\">0</span> &amp;&amp; d_minutes &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> d_minutes + <span class=\"string\">'分钟前'</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d_seconds &lt; <span class=\"number\">60</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d_seconds &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'刚刚'</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> d_seconds + <span class=\"string\">'秒前'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d_days &gt;= <span class=\"number\">3</span> &amp;&amp; d_days &lt; <span class=\"number\">30</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> M + <span class=\"string\">'-'</span> + D + <span class=\"string\">' '</span> + H + <span class=\"string\">':'</span> + m;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (d_days &gt;= <span class=\"number\">30</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Y + <span class=\"string\">'-'</span> + M + <span class=\"string\">'-'</span> + D + <span class=\"string\">' '</span> + H + <span class=\"string\">':'</span> + m;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"5微信小程序提交表单清空表单数据\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#5微信小程序提交表单清空表单数据\"></a> 5.微信小程序提交表单清空表单数据<a href=\"2017/12/04/wechat-app-together#5微信小程序提交表单清空表单数据\"></a></h3>\n<p>在发布活动之后,由于表单中的数据没有清空,给用户的体验必定不好,然而小程序的数据交互并不像<code>html + jS</code> 那样,使用 <code>dataSet({})</code> 来给赋值,视图层就能通过异步的方式活动到值,于是想到,在提交表单后,给这些<code>input</code>都赋值为空,那样就实现了清空表单的效果,当然,表单中并不只包含<code>input</code>,但是都可以通过这种方式实现清空效果</p>\n<ul>\n<li>WXML</li>\n</ul>\n<figure class=\"highlight html\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">bindsubmit</span>=<span class=\"string\">\"submitForm\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text</span> <span class=\"attr\">class</span>=<span class=\"string\">\"key\"</span>&gt;</span>活动名称<span class=\"tag\">&lt;/<span class=\"name\">text</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">\"title\"</span>  <span class=\"attr\">maxlength</span>=<span class=\"string\">\"100\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"&#123;&#123;title&#125;&#125;\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span>  <span class=\"attr\">formType</span>=<span class=\"string\">\"submit\"</span>&gt;</span>确定<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">submitForm:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">var</span> title = e.detail.value.title;</span><br><span class=\"line\">     ......</span><br><span class=\"line\">     success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"comment\">//将title值设置空</span></span><br><span class=\"line\">        that.setData(&#123;</span><br><span class=\"line\">            title: <span class=\"string\">''</span></span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"6微信号qq号手机号-正则校验\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#6微信号qq号手机号-正则校验\"></a> 6.微信号,QQ号,手机号 正则校验<a href=\"2017/12/04/wechat-app-together#6微信号qq号手机号-正则校验\"></a></h3>\n<p>由于申请加入活动需要填写真实姓名,联系方式等信息,为了防止用户随意填写信息,必须要对这些信息进行校验</p>\n<ul>\n<li>JS</li>\n</ul>\n<figure class=\"highlight javascript\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> wxReg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"^[a-zA-Z]([-_a-zA-Z0-9]&#123;5,19&#125;)+$\"</span>); <span class=\"comment\">//微信号正则校验</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> qqReg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"[1-9][0-9]&#123;4,&#125;\"</span>); <span class=\"comment\">//QQ号正则校验</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> phReg = <span class=\"regexp\">/^1[34578]\\d&#123;9&#125;$/</span>; <span class=\"comment\">//手机号正则校验</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> nameReg = <span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"^[\\u4e00-\\u9fa5]&#123;2,4&#125;$\"</span>); <span class=\"comment\">//2-4位中文姓名正则校验</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"7使用-bmob-sdk-实现报名成功发送模板消息生成小程序二维码等\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#7使用-bmob-sdk-实现报名成功发送模板消息生成小程序二维码等\"></a> 7.使用 Bmob SDK 实现报名成功发送模板消息,生成小程序二维码等<a href=\"2017/12/04/wechat-app-together#7使用-bmob-sdk-实现报名成功发送模板消息生成小程序二维码等\"></a></h3>\n<p>在开发过程中,由于想要实现,当用户报名成功后如何通知用户,查阅了小程序的开发文档发现有一个发送模板消息的API,再查询 Bmob 的开发文档,发现实现了这个功能,这个真的太有用了.模板消息只能再真机上才能发送成功,经过配置,重要成功,但是有在使用中出现一个问题<br>\n,就是在小程序发布后 模板消息中如果带有  <code>page</code> 参数将不会发送,但是在开发版中能发送成功, 这个问题已经反馈了,估计等Bmob小程序<code>SDK</code>更新后会解决这个问题.</p>\n<p>具体代码我就不写了,bmob开发文档直达</p>\n<ul>\n<li><a href=\"https://docs.bmob.cn/data/wechatApp/b_developdoc/doc/index.html#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF\" target=\"_blank\" rel=\"noopener\">发送模板消息</a></li>\n<li><a href=\"https://docs.bmob.cn/data/wechatApp/b_developdoc/doc/index.html#%E7%94%9F%E6%88%90%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BA%8C%E7%BB%B4%E7%A0%81\" target=\"_blank\" rel=\"noopener\">生成小程序二维码</a></li>\n</ul>\n<h2 id=\"截图-gif\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#截图-gif\"></a> 截图 &amp; GIF<a href=\"2017/12/04/wechat-app-together#截图-gif\"></a></h2>\n<div align=\"center\">\n<img src=\"/2017/12/04/wechat-app-together/7AgDLKB4Jc.gif\" width=\"250\">\n<img src=\"/2017/12/04/wechat-app-together/6DmcGmKfBK.gif\" width=\"250\">\n<img src=\"/2017/12/04/wechat-app-together/BgbjB83alh.gif\" width=\"250\">\n</div>\n<h2 id=\"bmob-数据库表结构设计\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#bmob-数据库表结构设计\"></a> Bmob 数据库表结构设计<a href=\"2017/12/04/wechat-app-together#bmob-数据库表结构设计\"></a></h2>\n<h4 id=\"用户表_user自带表\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#用户表_user自带表\"></a> 用户表:(_User，自带表)<a href=\"2017/12/04/wechat-app-together#用户表_user自带表\"></a></h4>\n<pre><code>|--objectId //Id\n|--userPic(String) //用户头像\n|--username(String) //用户名\n|--password(String) //密码\n|--nickname(String) //昵称\n|--sex(Number) //性别\n|--userData(Object) //微信登录用户数据\n|--eventJoin(Array) //参加的活动Id 数组Array\n|--eventFavo(Array) //收藏的活动Id 数组Array\n|--feednum(Number) //反馈次数\n</code></pre>\n<h4 id=\"活动信息表events\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#活动信息表events\"></a> 活动信息表：(Events)<a href=\"2017/12/04/wechat-app-together#活动信息表events\"></a></h4>\n<pre><code>|--objectId //活动Id\n|--publisher(Pointer--&gt;_User) //发起人\n|--title(String) //活动主题\n|--content(String) //活动内容\n|--actpic(File) //活动宣传照片\n|--acttype(String) //活动类别\n{\n    1：运动,2：游戏,3：交友,\n    4：旅行,5：读书,6：竞赛,\n    7：电影,8: 音乐,9: 其他\n}\n|--isShow(Number) //是否公开显示在首页\n|--endtime(String) //组队截止时间\n|--address(String) //活动地点\n|--latitude(Number)  //地址纬度\n|--longitude(Number) //地址经度\n|--peoplenum(String)//人数限制\n|--likenum(Number)  //点赞数\n|--liker(Array) //点赞人Id集合\n|--commentnum(Number) //评论数\n|--joinnumber(Number) // 现在参加的人数\n|--joinArray(Array) // 现在参加的人集合\n</code></pre>\n<h4 id=\"活动信息扩展表eventmore\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#活动信息扩展表eventmore\"></a> 活动信息扩展表:(EventMore)<a href=\"2017/12/04/wechat-app-together#活动信息扩展表eventmore\"></a></h4>\n<pre><code>|--objectId //活动信息扩展表Id\n|--event(Pointer--&gt;Events) //活动\n|--Status(Number) //活动状态,(1:准备中,2:进行中,3:已结束)\n|--Statusname(String) //活动状态名称\n|--qrcode(File) //活动群聊二维码\n</code></pre>\n<h4 id=\"评论表comments\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#评论表comments\"></a> 评论表：(Comments)<a href=\"2017/12/04/wechat-app-together#评论表comments\"></a></h4>\n<pre><code>|--objectId //评论Id\n|--publisher(Pointer--&gt;_User) //评论发布者\n|--olderUsername(String) //上一条评论人昵称\n|--olderComment(Pointer--&gt;Comments) //上一条评论\n|--event(Pointer--&gt;Events) //评论的活动\n|--content(String)  //评论内容\n</code></pre>\n<h4 id=\"点赞表likes\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#点赞表likes\"></a> 点赞表：(Likes)<a href=\"2017/12/04/wechat-app-together#点赞表likes\"></a></h4>\n<pre><code>|--objectId //点赞的Id\n|--liker(Pointer--&gt;_User) //点赞人\n|--event(Pointer--&gt;Events) //点赞的活动\n</code></pre>\n<h4 id=\"收藏表favos\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#收藏表favos\"></a> 收藏表:(Favos)<a href=\"2017/12/04/wechat-app-together#收藏表favos\"></a></h4>\n<pre><code>|--objectId //收藏的Id\n|--favor(Pointer--&gt;_User)  //收藏者\n|--event(Pointer--&gt;Events) //收藏的活动\n</code></pre>\n<h4 id=\"消息通知表plyre\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#消息通知表plyre\"></a> 消息通知表:(Plyre)<a href=\"2017/12/04/wechat-app-together#消息通知表plyre\"></a></h4>\n<pre><code>|--objectId //消息通知的Id\n|--fid(String)  //活动发布者Id(被赞或者被取消赞的人的ID,或者被回复,被评论的人的ID)(被通知的人)\n|--uid(Pointer--&gt;_User)   //消息通知人\n|--wid (String) //被赞，或者取消赞，被评论，或者被回复，加入，取消加入的活动id\n|--avatar (String) //消息通知人的头像\n|--username (String) //消息通知人的姓名\n|--is_read(Number) //这条消息是否已读（1代表已读，0代表未读）\n|--bigtype(Number) //消息通知大类(1代表消息，2代表通知)\n|--behavior(Number) //(消息提醒类型)\n{\n\t1：赞\n\t2：取消赞\n\t3：被评论\n\t4：被回复\n\t5：加入活动\n\t6：取消加入活动\n\t7：修改了加入信息\n}\n</code></pre>\n<h4 id=\"活动联系表contact\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#活动联系表contact\"></a> 活动联系表:(Contact)<a href=\"2017/12/04/wechat-app-together#活动联系表contact\"></a></h4>\n<pre><code>|--objectId //联系表Id\n|--publisher(Pointer--&gt;_User)  //活动发布者\n|--currentUser (Pointer--&gt;_User) //当前用户\n|--event(Pointer--&gt;Events)  //想要加入的活动\n|--realname (String) //真实姓名\n|--contactWay(String) //联系方式(微信号,手机号,QQ号)\n|--contactValue(String) //联系方式的号码\n</code></pre>\n<h4 id=\"反馈表feedback\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#反馈表feedback\"></a> 反馈表:(Feedback)<a href=\"2017/12/04/wechat-app-together#反馈表feedback\"></a></h4>\n<pre><code>|--objectId //反馈Id\n|--feedUser(Pointer--&gt;_User) //反馈人Id\n|--title(String) //反馈标题\n|--content(String) //反馈内容\n|--feedpic(File) //反馈图片\n|--feedinfo(String) //反馈用户的设备信息 \t\n</code></pre>\n<h2 id=\"感谢以下开源项目-网站社区\"><a class=\"markdownIt-Anchor\" href=\"2017/12/04/wechat-app-together#感谢以下开源项目-网站社区\"></a> 感谢以下开源项目、网站社区<a href=\"2017/12/04/wechat-app-together#感谢以下开源项目-网站社区\"></a></h2>\n<ul>\n<li><a href=\"https://docs.bmob.cn/\" target=\"_blank\" rel=\"noopener\">Bmob后端云</a></li>\n<li><a href=\"http://www.wxapp-union.com/\" target=\"_blank\" rel=\"noopener\">微信小程序联盟</a></li>\n<li><a href=\"https://github.com/Tencent/weui-wxss\" target=\"_blank\" rel=\"noopener\">WeUI for 小程序</a></li>\n<li><a href=\"https://github.com/youzan/zanui-weapp\" target=\"_blank\" rel=\"noopener\">有赞小程序 UI 库</a></li>\n<li><a href=\"https://github.com/skyvow/wux\" target=\"_blank\" rel=\"noopener\">微信小程序自定义组件（对话框、指示器、五星评分…）</a></li>\n<li><a href=\"https://github.com/icindy/wxSearch\" target=\"_blank\" rel=\"noopener\">微信小程序优雅的搜索框</a></li>\n<li><a href=\"https://github.com/mcc108/wecqupt\" target=\"_blank\" rel=\"noopener\">We重邮</a></li>\n<li><a href=\"https://github.com/songzeng2016/wechat-app-LeftSlide\" target=\"_blank\" rel=\"noopener\">QQ 向左滑动删除操作</a></li>\n<li><a href=\"https://github.com/zhongjie-chen/wx-drawer\" target=\"_blank\" rel=\"noopener\">模仿QQ6.0侧滑菜单</a></li>\n<li><a href=\"https://www.watch-life.net/\" target=\"_blank\" rel=\"noopener\">守望轩</a></li>\n</ul>\n<p>…</p>\n","prev":{"title":"fastJosn使用总结","link":"2018/05/13/using-fastjson"},"next":{"title":"使用Travis CI自动部署Hexo到GitHub","link":"2017/10/13/deylpoy-hexo-with-TravisCI"},"plink":"https://dmego.me/2017/12/04/wechat-app-together/","toc":[{"title":"<a class=\"markdownIt-Anchor\"></a> 前言","id":"前言","index":"1"},{"title":"<a class=\"markdownIt-Anchor\"></a> 小程序简介","id":"小程序简介","index":"2"},{"title":"<a class=\"markdownIt-Anchor\"></a> 小程序码","id":"小程序码","index":"3"},{"title":"<a class=\"markdownIt-Anchor\"></a> 开发中技术问题汇总","id":"开发中技术问题汇总","index":"4","children":[{"title":"<a class=\"markdownIt-Anchor\"></a> 1.使用e.target.dataset的出现问题","id":"1使用etargetdataset的出现问题","index":"4.1"},{"title":"<a class=\"markdownIt-Anchor\"></a> 2.小程序 textarea 文本框如何显示实时字数","id":"2小程序-textarea-文本框如何显示实时字数","index":"4.2"},{"title":"<a class=\"markdownIt-Anchor\"></a> 3.利用 JS 实现模糊查询","id":"3利用-js-实现模糊查询","index":"4.3"},{"title":"<a class=\"markdownIt-Anchor\"></a> 4.使用 JS 将字符串格式的时间转换成几秒前,几分钟前…","id":"4使用-js-将字符串格式的时间转换成几秒前几分钟前","index":"4.4"},{"title":"<a class=\"markdownIt-Anchor\"></a> 5.微信小程序提交表单清空表单数据","id":"5微信小程序提交表单清空表单数据","index":"4.5"},{"title":"<a class=\"markdownIt-Anchor\"></a> 6.微信号,QQ号,手机号 正则校验","id":"6微信号qq号手机号-正则校验","index":"4.6"},{"title":"<a class=\"markdownIt-Anchor\"></a> 7.使用 Bmob SDK 实现报名成功发送模板消息,生成小程序二维码等","id":"7使用-bmob-sdk-实现报名成功发送模板消息生成小程序二维码等","index":"4.7"}]},{"title":"<a class=\"markdownIt-Anchor\"></a> 截图 &amp; GIF","id":"截图-gif","index":"5"},{"title":"<a class=\"markdownIt-Anchor\"></a> Bmob 数据库表结构设计","id":"bmob-数据库表结构设计","index":"6"},{"title":"<a class=\"markdownIt-Anchor\"></a> 感谢以下开源项目、网站社区","id":"感谢以下开源项目-网站社区","index":"7"}],"copyright":{"link":"<a href=\"https://dmego.me/2017/12/04/wechat-app-together/\" title=\"微信小程序：出发吧一起\">https://dmego.me/2017/12/04/wechat-app-together/</a>","license":"自由转载-非商用-禁止演绎-保持署名(<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}